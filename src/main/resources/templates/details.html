<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Class Details</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

    <!-- jQuery & jsTree -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jstree@3.3.12/dist/themes/default/style.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/jstree@3.3.12/dist/jstree.min.js"></script>
</head>
<body>
<div class="container mt-5">
    <div class="row bg-info-subtle rounded-2 p-3">
        <h4 class="text-info-emphasis" th:text="${details['Preferred Name']}"></h4>
    </div>

    <div class="row g-2 mt-3">
        <div class="col-5 border border-dark">
            <h5>Ontology Tree</h5>
            <div id="ontologyTree">

                <script th:inline="javascript">
                    document.addEventListener("DOMContentLoaded", function () {
                        const selectedUri = /*[[${uri}]]*/ "";

                        fetch('/api/fulltree?selectedUri=' + encodeURIComponent(selectedUri))
                            .then(res => res.json())
                            .then(data => {
                                $('#ontologyTree').jstree({
                                    'core': {
                                        'data': data,
                                        'themes': {
                                            'dots': true,
                                            'icons': false  // remove folder icon
                                        }
                                    },
                                    'plugins': ["wholerow", "html_data"]
                                });
                            });
                    });
                </script>
            </div>
        </div>

        <div class="col-7">
            <div class="my-1">
                <h5 class="mt-2">Details for:</h5>
                <a class="fw-bolder text-info-emphasis text-decoration-none"
                   target="_blank" th:text="${uri}" th:href="${uri}"></a>
            </div>

            <table class="table table-bordered table-striped table-sm">
                <thead>
                <tr><th>Property</th><th>Value</th></tr>
                </thead>
                <tbody>
                <tr th:each="entry : ${details.entrySet()}">
                    <td th:text="${entry.key}"></td>
                    <td>
                        <!-- superclass chain -->
                        <span th:if="${entry.key == 'Superclass Chain'}"
                              th:each="pair, stat : ${#strings.arraySplit(entry.value, ';')}"
                              th:with="label=${pair.substring(0, pair.indexOf('|'))},
                                       superclassUri=${pair.substring(pair.indexOf('|') + 1)}">
                            <a th:href="@{/details(uri=${superclassUri})}" th:text="${label}"
                               class="text-decoration-none fw-semibold text-primary"></a>
                            <span th:if="${!stat.last}"> → </span>
                        </span>

                        <!-- synonyms -->
                        <span th:if="${entry.key == 'Synonyms'}">
                            <span th:if="${entry.value.contains('There are no')}" th:text="${entry.value}" class="fst-italic"></span>
                            <span th:if="${!entry.value.contains('There are no')}"
                                  th:each="syn : ${#strings.arraySplit(entry.value, ';')}"
                                  th:text="${syn.trim()}" class="me-2 badge text-bg-light"></span>
                        </span>

                        <!-- alternative -->
                        <span th:if="${entry.key == 'Alternative Label'}">
                            <span th:if="${entry.value.contains('There are no')}" th:text="${entry.value}" class="fst-italic"></span>
                            <span th:if="${!entry.value.contains('There are no')}"
                                  th:each="alt : ${#strings.arraySplit(entry.value, ';')}"
                                  th:text="${alt.trim()}" class="me-2 text-success fw-semibold"></span>
                        </span>

                        <!-- general -->
                        <span th:if="${entry.value.contains('|')
                                     && entry.key != 'Synonyms'
                                     && entry.key != 'Superclass Chain'}"
                              th:with="label=${entry.value.substring(0, entry.value.indexOf('|'))},
                                       uriLink=${entry.value.substring(entry.value.indexOf('|') + 1)}">
                            <a th:href="@{/details(uri=${uriLink})}" th:text="${label}"
                               class="text-decoration-none fw-medium btn btn-outline-primary me-2"></a>
                        </span>

                        <!-- fallback plain value -->
                        <span th:if="${!entry.value.contains('|')
                                     && entry.key != 'Synonyms'
                                     && entry.key != 'Alternative Label'
                                     && entry.key != 'Superclass Chain'}"
                              th:text="${entry.value}"></span>
                    </td>
                </tr>
                </tbody>
            </table>

            <a th:href="@{/}" class="btn btn-outline-secondary mt-3">← Back to Search</a>
        </div>
    </div>
</div>
</body>
</html>